<!-- templates/index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>PCB Inspection Papers</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='fonts.css') }}">
    <script src="{{ url_for('static', filename='scripts.js') }}" defer></script>
</head>
<body>
    
<div class="table-container"> <!-- Wrapper for horizontal scrolling -->
<table id="papersTable">
    <thead>
        <tr>
            <th colspan="6">PCB Inspection Papers Database</th><th colspan="6">Classification</th><th colspan="5">Features</th><th colspan="4">Techniques</th><th colspan="4">Status</th>
        </tr>
        <tr>
            <th class="rotate-header status-header editable-header" data-sort="type"><div><span>Type</span></div></span><span class="sort-indicator"></span></th>

            <th data-sort="title">Title (Click for article) <span class="sort-indicator"></span></th>
            <th data-sort="authors">Authors <span class="sort-indicator"></span></th>
            <th data-sort="year">Year <span class="sort-indicator"></span></th>
            <th data-sort="journal">Journal/Conf <span class="sort-indicator"></span></th>

            <!-- Classification Summary Columns -->
            <th class="rotate-header" data-sort="research_area"><div><span>Research Area</span></div></th>
            <th class="rotate-header status-header editable-header" data-sort="is_survey"><div><span>Survey</span></div></th>
            <th class="rotate-header status-header editable-header" data-sort="is_offtopic"><div><span>Off-topic</span></div></th>
            <th class="rotate-header status-header editable-header" data-sort="is_through_hole"><div><span>THT</span></div></th>
            <th class="rotate-header status-header editable-header" data-sort="is_smt"><div><span>SMT</span></div></th>
            <th class="rotate-header status-header editable-header" data-sort="is_x_ray"><div><span>X-Ray</span></div></th>

            <!-- Features Summary Columns -->
            <th class="rotate-header status-header editable-header" data-sort="features_solder"><div><span>Solder</span></div></th>
            <th class="rotate-header status-header editable-header" data-sort="features_polarity"><div><span>Polarity</span></div></th>
            <th class="rotate-header status-header editable-header" data-sort="features_wrong_component"><div><span>Wrong Comp</span></div></th>
            <th class="rotate-header status-header editable-header" data-sort="features_missing_component"><div><span>Missing Comp</span></div></th>
            <th class="rotate-header status-header editable-header" data-sort="features_tracks"><div><span>Tracks</span></div></th>
            <th class="rotate-header status-header editable-header" data-sort="features_holes"><div><span>Holes</span></div></th>

            <!-- Techniques Summary Columns -->
            <th class="rotate-header status-header editable-header" data-sort="technique_classic_computer_graphics_based"><div><span>Classic CG</span></div></th>
            <th class="rotate-header status-header editable-header" data-sort="technique_machine_learning_based"><div><span>ML</span></div></th>
            <th class="rotate-header status-header editable-header" data-sort="technique_hybrid"><div><span>Hybrid</span></div></th>
            <th class="rotate-header status-header editable-header" data-sort="technique_available_dataset"><div><span>Datasets</span></div></th>

            <th data-sort="changed" style="width:50px; min-width:50px; max-width:50px">Last Changed <span class="sort-indicator"></span></th>
            <th data-sort="changed_by" style="width:60px; min-width:60px; max-width:60px">Changed By <span class="sort-indicator"></span></th>
            <th style="width:50px; min-width:50px; max-width:50px">Actions</th>
        </tr>
    </thead>
    <tbody>
    {% for paper in papers %}
        <tr data-paper-id="{{ paper.id }}">
            <!-- Use the emoji mapping passed from Python -->
            <td class="status-cell title="{{ paper.type }}">{{ type_emojis.get(paper.type, default_type_emoji) }} </td>
            <td class="title-cell"><a href="https://doi.org/{{ paper.doi }}" target="_blank">{{ paper.title }}</a></td>
            <td class="secondary-text-cell">{{ paper.authors_truncated }}</td>
            <td class="secondary-text-cell">{{ paper.year or '' }}</td>
            <td class="secondary-text-cell">{{ paper.journal }}</td>

            <!-- Classification Summary Cells -->
            <td class="secondary-text-cell research-area-cell">{{ paper.research_area or '' }}</td>
            <!-- Add data-field and editable-status class -->
            <td class="status-cell editable-status" data-field="is_survey">{{ paper.is_survey | render_status }}</td>
            <td class="status-cell editable-status" data-field="is_offtopic">{{ paper.is_offtopic | render_status }}</td>
            <td class="status-cell editable-status" data-field="is_through_hole">{{ paper.is_through_hole | render_status }}</td>
            <td class="status-cell editable-status" data-field="is_smt">{{ paper.is_smt | render_status }}</td>
            <td class="status-cell editable-status" data-field="is_x_ray">{{ paper.is_x_ray | render_status }}</td>

            <!-- Features Summary Cells -->
            <td class="status-cell editable-status" data-field="features_solder">{{ paper.features.solder | render_status }}</td>
            <td class="status-cell editable-status" data-field="features_polarity">{{ paper.features.polarity | render_status }}</td>
            <td class="status-cell editable-status" data-field="features_wrong_component">{{ paper.features.wrong_component | render_status }}</td>
            <td class="status-cell editable-status" data-field="features_missing_component">{{ paper.features.missing_component | render_status }}</td>
            <td class="status-cell editable-status" data-field="features_tracks">{{ paper.features.tracks | render_status }}</td>
            <td class="status-cell editable-status" data-field="features_holes">{{ paper.features.holes | render_status }}</td>

            <!-- Techniques Summary Cells -->
            <td class="status-cell editable-status" data-field="technique_classic_computer_graphics_based">{{ paper.technique.classic_computer_graphics_based | render_status }}</td>
            <td class="status-cell editable-status" data-field="technique_machine_learning_based">{{ paper.technique.machine_learning_based | render_status }}</td>
            <td class="status-cell editable-status" data-field="technique_hybrid">{{ paper.technique.hybrid | render_status }}</td>
            <td class="status-cell editable-status" data-field="technique_available_dataset">{{ paper.technique.available_dataset | render_status }}</td>

            <td class="secondary-text-cell changed-cell">{{ paper.changed_formatted }}</td> <!-- Use formatted timestamp -->
            <td class="secondary-text-cell changed-by-cell">{{ paper.changed_by or '' }}</td>
            <td class="toggle-btn"  onclick="toggleDetails(this)"><span>Expand</span></td>
        </tr>
        <tr class="detail-row">
            <td colspan="24"> <!-- Ensure colspan matches total header columns -->
                <div class="detail-flex-container"> <!-- New wrapper for flex layout -->
                    <div class="detail-content detail-abstract">
                        <p><strong>Abstract:</strong> {{ paper.abstract }}</p>
                    </div>
                    <div class="detail-content detail-metadata">
                        <p><strong>Keywords:</strong> {{ paper.keywords }}</p>
                        <p><strong>DOI:</strong> <a href="https://doi.org/{{ paper.doi }}" target="_blank">{{ paper.doi }}</a></p>
                        <p><strong>ISSN:</strong> {{ paper.issn }}</p>
                        <p><strong>Pages:</strong> {{ paper.pages }}</p>
                        <p><strong>ID:</strong> {{ paper.id }}</p> <!-- Show ID in details -->
                        <p><strong>Full Authors:</strong> {{ paper.authors }}</p> <!-- Show full authors in details -->
                    </div>
                    <div class="edit-section detail-edit">
                        <h3>Edit Classification</h3>
                        <form id="form-{{ paper.id }}" data-paper-id="{{ paper.id }}">
                            <label>Research Area:
                                <input type="text" class="editable" name="research_area" value="{{ paper.research_area or '' }}">
                            </label><br>
                            <button type="button" class="save-btn" onclick="saveChanges('{{ paper.id }}')">Save Changes</button>
                        </form>
                    </div>
                </div>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>
</div> <!-- End table-container -->

</body>
</html>